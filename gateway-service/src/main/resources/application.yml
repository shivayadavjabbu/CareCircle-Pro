server:
  port: 8080

spring:
  application:
    name: gateway-service

  cloud:
    gateway:
      routes:

        # =========================
        # AUTH SERVICE
        # =========================
        - id: auth-service
          uri: http://localhost:8081
          predicates:
            - Path=/auth/**
          # No StripPrefix needed for /auth/** as controller expects /auth/...

        # =========================
        # MATCHING SERVICE
        # =========================
        - id: matching-service-cities
          uri: http://localhost:8085
          predicates:
            - Path=/cities/**, /services/**
          # Controller expects /cities... or /services...

        - id: matching-service-admin
          uri: http://localhost:8085
          predicates:
            - Path=/admin/cities/**, /admin/matching/**, /admin/services/**
          # Controller expects /admin/cities, /admin/matching, /admin/services...

        - id: matching-service-legacy
          uri: http://localhost:8085
          predicates:
            - Path=/matching-booking-service/**
          filters:
            - StripPrefix=1

        # =========================
        # USER PROFILE SERVICE
        # =========================
        - id: user-profile-parents
          uri: http://localhost:8083
          predicates:
            - Path=/parents/**
          # Controller expects /parents...

        - id: user-profile-caregiver
          uri: http://localhost:8083
          predicates:
            - Path=/caregiver/**
          # Controller expects /caregiver...
          
        - id: user-profile-children
          uri: http://localhost:8083
          predicates:
             - Path=/children/**

        - id: user-profile-admin
          uri: http://localhost:8083
          predicates:
            - Path=/admin/**
          # Catch-all for other admin routes (User Profile service)
          # Note: Specific admin routes (cities, matching) must be defined ABOVe this to take precedence

        - id: user-profile-service-legacy
          uri: http://localhost:8083
          predicates:
            - Path=/user-profile-service/**
          filters:
            - StripPrefix=1

        # =========================
        # COMMUNICATION SERVICE
        # =========================
        - id: communication-service
          uri: http://localhost:8082
          predicates:
            - Path=/communication-service/**
          filters:
            - StripPrefix=1

        - id: communication-ws
          uri: ws://localhost:8082
          predicates:
            - Path=/ws/**

jwt:
  secret: carecircle-auth-secret-key-which-is-at-least-32-bytes-long

management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
